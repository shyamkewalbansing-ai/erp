<analysis>**original_problem_statement:**
De gebruiker wil een uitgebreide Boekhouding (Accounting) module bouwen die specifiek is afgestemd op de Surinaamse markt. De kerninstructie is om de structuur en UI van een referentieproject  te volgen. De scope is uitgebreid met features zoals PDF-facturen met templates, MT940-import, Surinaamse belastingrapportages, Excel-exports, configureerbare SMTP-instellingen en multi-tenancy.

Recentelijk heeft de gebruiker de focus verlegd naar de implementatie van een volledig functioneel Point of Sale (POS) systeem, geïnspireerd door een afbeelding van een SumUp-achtige interface. Deze POS-module moest fullscreen zijn, een productgrid, een winkelwagen, en de mogelijkheid hebben om betalingen te verwerken. De meest recente verzoeken waren gericht op het uitbreiden van de POS-functionaliteit met een camera-gebaseerde barcode scanner, specifiek een versie die op een mobiel apparaat kan worden gebruikt via een openbare link, zonder dat een login vereist is.

**PRODUCTVEREISTEN:**
-   **Valuta:** SRD, USD, EUR.
-   **Wisselkoersen:** Zowel handmatige invoer als automatische synchronisatie.
-   **Thema & UI:** Clean en modern.
-   **Backend:** FastAPI met MongoDB.
-   **Frontend:** React met TailwindCSS.
-   **Kernfunctionaliteit:**
    -   Alle financiële transacties (verkoop, inkoop, betalingen, POS) moeten automatisch leiden tot een journaalpost in het grootboek.
    -   Rapportages (Balans, Winst & Verlies) moeten worden gegenereerd op basis van de saldi in het grootboek.
    -   Een volledig POS-systeem met productbeheer, winkelwagen, betalingsverwerking (inclusief wisselgeld), kortingen en klantkoppeling.
    -   Een camera-gebaseerde barcode scanner, inclusief een openbaar toegankelijke mobiele scanner-pagina die kan synchroniseren met de hoofd-POS-terminal.
    -   Producten in de voorraad moeten een barcodeveld hebben dat ingevuld kan worden (ook via camera-scan).

**User's preferred language**: Dutch

**what currently exists?**
De applicatie is een full-stack React/FastAPI-app met een geïntegreerde boekhoudmodule waarbij het grootboek de centrale source of truth is. Een uitgebreide Point of Sale (POS) module is geïmplementeerd met een fullscreen interface, productgrid, winkelwagen, en verwerking van betalingen (contant/pin) inclusief wisselgeldberekening en kortingen.

Een van de meest geavanceerde features is de camera-gebaseerde barcode scanner. Dit omvat een **openbare, login-vrije mobiele scanner pagina**. De hoofd-POS terminal kan een tijdelijke, unieke sessielink via een QR-code genereren. Wanneer deze link op een telefoon wordt geopend, kan de gebruiker producten scannen die vervolgens direct in de winkelwagen van de hoofd-POS verschijnen.

**Last working item**:
-   **Last item agent was working:** De agent was bezig met het implementeren van de mogelijkheid om een barcode op te slaan bij een product op de 'Voorraad' (Inventory) pagina. Dit omvat het toevoegen van een barcode-invoerveld en een knop om de camera te gebruiken voor het scannen van de barcode in het Product toevoegen/bewerken formulier.
-   **Status:** IN PROGRESS
-   **Agent Testing Done:** N
-   **Which testing method agent to use?** Frontend testing agent. De test moet verifiëren dat een barcode kan worden toegevoegd/bewerkt (handmatig en via camera) op de Voorraadpagina, correct wordt opgeslagen, en dat het product vervolgens kan worden gevonden met de POS-scanner.
-   **User Testing Done:** N

**All Pending/In progress Issue list**:
-   **Issue 1: Kritiek groot  bestand (P1)**
    -   **Beschrijving:** Het  bestand is hernoemd naar  en is met meer dan 5300 regels onbeheersbaar. Alle nieuwe backend-logica (POS, scanner sessies) is hieraan toegevoegd, waardoor de technische schuld ernstig is toegenomen. Een eerdere poging tot refactoring is vastgelopen.
    -   **Attempted fixes:** Een nieuwe modulaire directorystructuur () is aangemaakt, maar de agent is teruggevallen op het aanpassen van het legacy-bestand om nieuwe features sneller te leveren.
    -   **Next debug checklist:**
        1.  Hervat het refactoringplan.
        2.  Verplaats business logic (zoals ) naar een  laag.
        3.  Verdeel de endpoints uit  stapsgewijs over thematische bestanden: , , , en een nieuw .
        4.  Werk  bij om de nieuwe, kleinere routers te gebruiken en de verwijzing naar  te elimineren.
    -   **Why fix this issue and what will be achieved with the fix?** Verhoogt de onderhoudbaarheid, stabiliteit en schaalbaarheid van de backend. Dit is cruciaal om toekomstige ontwikkeling mogelijk te maken.
    -   **Status:** IN PROGRESS (Stalled)
    -   **Is recurring issue?** Y
    -   **Should Test frontend/backend/both after fix?** both (een grondige regressietest is absoluut noodzakelijk).

**In progress Task List**:
-   **Task 1: Barcode veld toevoegen aan Voorraad (P0)**
    -   **Where to resume:** De agent was bezig met het aanpassen van . De volgende stappen zijn: het toevoegen van de UI voor het barcodeveld (input + camera-knop) aan het productformulier, het implementeren van de camera-scanlogica, en het bijwerken van de  functie om de barcode mee te sturen naar de backend.
    -   **What will be achieved with this?** Gebruikers kunnen barcodes aan hun producten koppelen, wat essentieel is voor een betrouwbare werking van de POS-scanner.
    -   **Status:** IN PROGRESS
    -   **Should Test frontend/backend/both after fix?** both
    -   **Blocked on something:** Nee.

**Upcoming and Future Tasks**
-   **Upcoming Tasks:**
    -   **P1 - Refactor :** Zie All Pending/In progress Issue list. Dit heeft de hoogste prioriteit na het voltooien van de huidige taak.
    -   **P1 - Verifieer POS-Grootboek Koppeling:** De gebruiker heeft expliciet zijn zorg geuit dat POS-transacties mogelijk niet correct worden geboekt. Er moet grondig worden geverifieerd of contante en pin-betalingen de saldi van 'Kas' en 'Bank' en de omzetrekeningen correct bijwerken.
    -   **P2 - Refactor Grote Frontend Componenten:**  (nu >1400 regels), , en  moeten worden opgesplitst. Extraheer dialogen (betaling, korting, scanner) en andere logische delen naar hun eigen, herbruikbare componenten.

-   **Future Tasks:**
    -   **P3 - Kassarapport:** Een rapport om aan het einde van de dag de kas op te maken en de dagomzet per betaalmethode te tonen.
    -   **P3 - Implementeer MT940-import.**
    -   **P3 - Implementeer Excel-exports voor alle relevante data.**
    -   **P3 - Verifieer logo op PDF-facturen:** De UI voor het uploaden van een logo is gebouwd, maar er moet nog worden gecontroleerd of dit logo daadwerkelijk op de gegenereerde PDF-facturen wordt weergegeven.

**Completed work in this session**
-   **Point of Sale (POS) Module:**
    -   Een volledig nieuwe, fullscreen POS-interface () gebouwd.
    -   Functionaliteit geïmplementeerd voor het toevoegen van producten aan een winkelwagen.
-   **POS Uitbreidingen:**
    -   Een betaaldialoog met een **wisselgeldcalculator** voor contante betalingen.
    -   Functionaliteit om kortingen toe te passen op de hele winkelwagen.
    -   Mogelijkheid om een klant aan een verkoop te koppelen.
-   **Camera Barcode Scanner:**
    -   De  bibliotheek geïnstalleerd en geïntegreerd.
    -   Een camera-scanner toegevoegd aan de POS-pagina om producten te scannen en toe te voegen.
-   **Publieke Mobiele Scanner:**
    -   Een aparte, publieke pagina () gemaakt die **zonder login** werkt.
    -   Backend-logica geïmplementeerd om tijdelijke scanner-sessies te beheren.
    -   De hoofd-POS kan een QR-code genereren die, wanneer gescand met een telefoon, de mobiele scanner opent en deze koppelt aan de winkelwagen van de hoofd-POS.
-   **Bugfix:** Een bug op de  opgelost die werd veroorzaakt door het gebruik van een verkeerde API en incorrecte veldnamen.

**Earlier issues found/mentioned but not fixed**
-   Het  bestand is niet gerefactord en is alleen maar groter en complexer geworden.
-   De grote frontend componenten (, , en nu ook ) zijn niet opgesplitst.

**Known issue recurrence from previous fork**
-   Geen.

**Code Architecture**


**Key Technical Concepts**
-   **Public Session Management:** De backend creëert een unieke  met een vervaltijd. De hoofd-POS genereert een QR-code voor een link (). De mobiele scanner-pagina gebruikt deze  om gescande producten via de backend naar de juiste winkelwagen te sturen.
-   **Camera API:** Gebruik van de  bibliotheek om toegang te krijgen tot de camera van het apparaat voor het scannen van barcodes.
-   **QR Code Generation:** Gebruik van de  bibliotheek om de sessie-link als een scanbare QR-code weer te geven.

**key DB schema**
-   ** (Nieuw):** 
-   ** (Aanpassing nodig):** Moet een  veld krijgen.

**changes in tech stack**
-   **Frontend Dependencies (nieuw):**
    -   
    -   

**All files of reference**
-    (Het meest kritieke backend-bestand)
-    (Het hart van de nieuwe POS-functionaliteit)
-    (Bestand dat momenteel wordt bewerkt)
-    (De publieke scanner-pagina)
-    (Hier zijn de nieuwe routes gedefinieerd)
-    (Bijgewerkt met de nieuwe features)

**Areas that need refactoring**:
-   **:** **CRITICAL**. Moet met hoogste prioriteit worden opgesplitst.
-   **:** Dit bestand is onhoudbaar groot. De logica voor de verschillende dialogen (betaling, korting, scanner, QR-code) moet worden geëxtraheerd naar aparte, herbruikbare componenten.

**key api endpoints**
-   
-   
-    (Publiek, geen authenticatie)
-    (Publiek, geen authenticatie)
-    (Moet worden bijgewerkt om het -veld te accepteren)

**Critical Info for New Agent**
-   **PRIORITEIT 1: Voltooi Barcode in Voorraad.** Maak de huidige taak af: voeg het barcodeveld met camera-scanmogelijkheid toe aan de . Test dit end-to-end.
-   **PRIORITEIT 2: Refactor **. Dit is een enorme technische schuld en een groot risico. Begin hieraan direct na de voorraad-taak. Voeg geen nieuwe features meer toe aan dit bestand. Gebruik de al bestaande modulaire structuur in .
-   **Publieke Scanner Werking:** Onthoud dat de publieke scanner asynchroon werkt via een  in de database. De hoofd-POS genereert de sessie, de telefoon scant en voegt items toe via de backend, en de hoofd-POS haalt de bijgewerkte winkelwagen op.

**documents and test reports created in this job**
-   
-   

**Last 10 User Messages and any pending HUMAN messages**
1.  **User:** jhaa - **Status:** COMPLETED. Bevestiging om door te gaan met het toevoegen van het barcodeveld aan de Voorraadpagina.
2.  **User:** Ik wil niet ingelogd zijn maak een aparte page met scanner en een link waar ik op kan gaan en dan word het gescant en gelijk gescant zonder inloggen - **Status:** COMPLETED. Dit leidde tot de creatie van de succesvolle publieke scanner-pagina.
3.  **User:** Telefoon Scanner werkt niet wat is link dan zo dat ik via een andere telefoon kan gaan - **Status:** COMPLETED. De verwarring van de gebruiker leidde tot de verbetering (de publieke scanner).
4.  **User:** Jha maar ik wil een link waarop je kan gaan op je telefoon en dan scann je en dan word het product gescant - **Status:** COMPLETED. Verzoek voor een mobiel-specifieke scannerlink.
5.  **User:** Barcode scanner kan je iets maken zo dat je via een telefoon camera product kan scannen - **Status:** COMPLETED. Dit was het initiële verzoek voor de camera-scanner.
6.  **User:** ...en ik mis iets om bedrag in te toetsen en wisseld geld te zien... en als je POS gebruikt waar gaat dat geld heen ik zie dat het niet goed gekopeld is aan de systeem - **Status:** IN PROGRESS. De wisselgeldfunctie is gebouwd, maar de verificatie van de boekhoudkundige koppeling is nog een openstaand punt (P1 Upcoming Task).
7.  **User:** P2 (om POS uit te breiden) - **Status:** COMPLETED.
8.  **User:** Verzoek om POS functie toe te voegen (met afbeelding) - **Status:** COMPLETED.
9.  **User:** p1 en p2 - **Status:** COMPLETED. Akkoord met het plan om te refactoren en P2-taken uit te voeren (hoewel de refactoring is uitgesteld).
10. **Agent:** Initiële planning.

**Project Health Check:**
-   **Broken:** Geen. De applicatie is functioneel.
-   **Mocked:** Geen.
-   **Risks:**
    -   **CRITICAL:** De  is een tikkende tijdbom die de stabiliteit en toekomstige ontwikkeling van de hele applicatie in gevaar brengt.
    -   **HIGH:** De frontend componenten (, ) worden te groot, wat leidt tot slechte onderhoudbaarheid en een verhoogd risico op bugs.
    -   **MEDIUM:** De correcte financiële boeking van POS-transacties is nog niet door de gebruiker geverifieerd en was een expliciet punt van zorg.

**3rd Party Integrations**
-   
-   

**Testing status**
-   **Testing agent used after significant changes:** YES, na de eerste POS-uitbreidingen (). Echter, de camera-scanner en publieke scanner-functies zijn daarna toegevoegd **zonder** een nieuwe testcyclus.
-   **Troubleshoot agent used after agent stuck in loop:** NO
-   **Test files created:** []
-   **Known regressions:** Geen.

**Credentials to test flow:**
-   **Gebruikersnaam:** 
-   **Wachtwoord:** 

**What agent forgot to execute**
-   De agent heeft de cruciale refactoring van  (nu ) niet voltooid. In plaats daarvan werd prioriteit gegeven aan nieuwe features, waardoor de technische schuld aanzienlijk is toegenomen.
-   De refactoring van grote frontend-componenten is ook niet uitgevoerd.</analysis>
