<analysis>**original_problem_statement:**
De gebruiker wil een uitgebreide Boekhouding (Accounting) module bouwen die specifiek is afgestemd op de Surinaamse markt. De kerninstructie is om de structuur en UI van een referentieproject  te volgen. De scope is uitgebreid met features zoals PDF-facturen met templates, MT940-import, Surinaamse belastingrapportages, Excel-exports, configureerbare SMTP-instellingen, multi-tenancy, en het automatisch ophalen van wisselkoersen. Recentelijk heeft de gebruiker een reeks zeer specifieke UI/UX-wijzigingen en bugfixes aangevraagd, met name voor de sidebar-navigatie en de functionaliteit van de Voorraad- en Verkoop-pagina's.

**PRODUCTVEREISTEN:**
-   **Valuta:** SRD, USD, EUR.
-   **Wisselkoersen:** Zowel handmatige invoer als automatische synchronisatie van .
-   **Thema & UI:** Clean en modern, gebaseerd op een Finance OS-afbeelding en een GitHub-repository. De gebruiker heeft de laatste sessie veel specifieke verzoeken gedaan voor de sidebar, waaronder een zoekbalk, een inklapfunctie en tooltips.
-   **Producten & Facturen:** Producten hebben een foto. Facturen gebruiken een product-dropdown en hebben volledige CRUD- en statusbeheerfunctionaliteit, inclusief het registreren van betalingen. Productfoto's moeten op de PDF's verschijnen.
-   **Backend:** FastAPI met MongoDB.
-   **Frontend:** React met TailwindCSS.

**User's preferred language**: Dutch

**what currently exists?**
De applicatie is een full-stack React/FastAPI-app. In deze sessie heeft de agent een groot aantal UI-verbeteringen en bugfixes doorgevoerd. De product-fotoupload en artikel-selectie op facturen zijn voltooid en de productfoto's worden nu ook op de PDF-facturen getoond. Er is een reeks bugs opgelost op de Voorraad- en Verkoop-pagina's, voornamelijk veroorzaakt door inconsistenties in veldnamen tussen de frontend (Engels) en backend (Nederlands). De sidebar is volledig herzien met een zoekfunctie, een inklapmechanisme, tooltips en een logica die de actieve module onthoudt. Er zijn CRUD-acties (bewerken/verwijderen) toegevoegd aan producten en mutaties, en de factuurworkflow is uitgebreid met statuswijzigingen en de mogelijkheid om betalingen te registreren.

**Last working item**:
-   **Last item agent was working:** Een Betaling Toevoegen functionaliteit implementeren voor verkoopfacturen, inclusief een dialoogvenster om het bedrag, de datum en de betaalmethode vast te leggen.
-   **Status:** USER VERIFICATION PENDING
-   **Agent Testing Done:** Y
-   **Which testing method agent to use?** both. De backend-endpoint () moet worden getest via  om te verifiëren dat een betaling correct wordt opgeslagen en de factuurstatus/openstaand bedrag bijwerkt. De frontend vereist een screenshot of E2E-test om het openen van de dialoog, het invullen en het verzenden van het formulier te valideren.
-   **User Testing Done:** N

**All Pending/In progress Issue list**:
-   **Issue 1: Inconsistentie in datamodel tussen frontend en backend (P0)**
    -   **Beschrijving:** De frontend gebruikt Engelse veldnamen (, , Sat Feb 28 00:57:09 UTC 2026) terwijl de backend Nederlandse veldnamen verwacht (, , ). Dit is de hoofdoorzaak van bijna alle bugs die in de laatste sessie zijn opgelost (op de Voorraad- en Verkoop-pagina's). De agent heeft dit per geval opgelost door de data vlak voor de API-call te transformeren, maar er is geen structurele oplossing.
    -   **Attempted fixes:** Ad-hoc data-objecten transformeren in  functies in  en . Dit lost het probleem lokaal op maar niet systematisch.
    -   **Next debug checklist:**
        1.  Inventariseer alle formulieren en API-calls binnen de boekhouding-module.
        2.  Pas de  aan met centrale  en  helper-functies, zoals gesuggereerd in een eerdere handoff.
        3.  Refactor alle API-calls om deze helpers te gebruiken, wat de code schoner maakt en toekomstige bugs voorkomt.
    -   **Why fix this issue and what will be achieved with the fix?** Dit is een zeer terugkerend probleem dat bij elke nieuwe formulierimplementatie voor fouten zorgt. Een structurele oplossing bespaart veel ontwikkeltijd en verhoogt de stabiliteit van de applicatie.
    -   **Status:** IN PROGRESS
    -   **Is recurring issue?** Y
    -   **Should Test frontend/backend/both after fix?** both

**In progress Task List**:
-   Geen.

**Upcoming and Future Tasks**
-   **Upcoming Tasks:**
    -   **P1 - Systematische refactor van veldnaam-inconsistentie:** Los de problemen uit All Pending/In progress Issue list structureel op.
    -   **P1 - Verbeter Multi-tenancy:** Zorg ervoor dat *alle* databasequeries strikt gefilterd worden op .
    -   **P2 - Implementeer Logo Upload voor Facturen:** Voeg een UI toe in de Instellingen-pagina om een bedrijfslogo te uploaden dat op PDF-facturen wordt gebruikt.
    -   **P2 - Breid Rapportages uit:** Bouw de Balans- en Winst-en-verliesrekening functionaliteit.

-   **Future Tasks:**
    -   **P2 - Refactor :** Het bestand is met >15.000 regels onbeheersbaar. Splits de logica op in modulaire routers (bijv.  bevat al een deel, maar meer kan worden afgesplitst).
    -   **P3 - Extraheer Herbruikbare UI Componenten:** Maak een generiek  component om de UI-consistentie op alle dashboard-achtige pagina's af te dwingen.

**Completed work in this session**
-   **Product & Factuur Functionaliteit:**
    -   Product foto-upload en weergave in de voorraadlijst is voltooid ().
    -   Productfoto's worden nu op PDF-facturen getoond ().
    -   Factuurinvoer is omgezet naar een artikel-dropdown ().
-   **CRUD & Workflow op Voorraadpagina:**
    -   Bugs opgelost m.b.t. voorraadweergave en het aanmaken van mutaties.
    -   Acties (Bewerken, Verwijderen) toegevoegd aan de productentabel.
    -   Actie (Verwijderen) toegevoegd aan de mutatietabel.
-   **CRUD & Workflow op Verkooppagina:**
    -   Bug opgelost bij het aanmaken van een nieuwe factuur.
    -   Dataweergave in de factuurlijst gecorrigeerd.
    -   Actiemenu toegevoegd met opties voor statuswijziging (Verzenden, Betaald), verwijderen en het toevoegen van betalingen.
-   **Sidebar UI/UX Verbeteringen ():**
    -   Bug opgelost waarbij de boekhouding-sidebar verdween op de instellingenpagina.
    -   De user redirect-logica gefixt zodat de juiste module wordt getoond.
    -   Een zoekbalk toegevoegd onder het logo.
    -   De sidebar inklapbaar gemaakt met een knop.
    -   Tooltips toegevoegd voor items in de ingeklapte sidebar.
    -   Sidebar-headers vervangen door de modulenaam als klikbare dashboard-link.

**Earlier issues found/mentioned but not fixed**
-   De veldnaam-inconsistentie is alleen lokaal opgelost, niet structureel.
-   Het  bestand is nog steeds niet gerefactord.

**Known issue recurrence from previous fork**
-   **Issue:** Inconsistentie tussen Engelse frontend veldnamen en Nederlandse backend veldnamen.
-   **Recurrence count:** Hoog (veroorzaakte 4-5 aparte bugfixes in deze sessie).
-   **Status:** IN PROGRESS (meerdere patches toegepast, geen structurele oplossing).

**Code Architecture**


**Key Technical Concepts**
-   **Backend:** FastAPI, Pydantic, MongoDB, ReportLab.
-   **Frontend:** React, TailwindCSS, State management met  en , conditionele rendering, Modals/Dialogs, Dropdown menus.
-   **Probleemoplossing:** De belangrijkste vaardigheid was het debuggen van mismatches tussen de datastructuur die de React-frontend verstuurt en de structuur die de Pydantic-modellen in de FastAPI-backend verwachten.

**key DB schema**
-   ****: Bevat nu een  (payments) array. De status kan , , of  zijn.
-   ****: Heeft nu een  veld.
-   ****: Collectie voor voorraadmutaties (, , ).

**changes in tech stack**
-   Geen.

**All files of reference**
-   
-   
-   
-   
-   
-   
-   
-   

**Areas that need refactoring**:
-   **Veldnaam-vertaling:** De ad-hoc data transformaties in de  functies moeten worden vervangen door een centrale helper-functie in  om het Engels/Nederlands naamgevingsprobleem definitief op te lossen.
-   **:** Dringend opsplitsen in modulaire routers.
-   **Frontend Pagina's:**  (>800 regels) en  (>700 regels) zijn te groot geworden. De logica voor de verschillende dialogen (, , , , ) moet worden geëxtraheerd naar eigen componenten.

**key api endpoints**
-    (Nieuw)
-    (Nieuw)
-    (Nieuw)
-    (Nieuw)
-    (Nieuw)
-    (Gebruikt)

**Critical Info for New Agent**
-   **Prioriteit 1: Veldnaam-inconsistentie.** De meest voorkomende bug is de mismatch tussen Engelse frontend-veldnamen en Nederlandse backend-modellen. Het oplossen van dit probleem op een pagina vereist dat je de payload die naar de API wordt gestuurd handmatig aanpast. Wees hierop voorbereid voor elke nieuwe functie of bugfix met formulieren. Het voorstellen van een structurele oplossing is de hoogste prioriteit.
-   **Gebruikersinteractie:** De gebruiker is zeer direct, visueel georiënteerd en vraagt om veel specifieke UI-wijzigingen. Gebruik screenshots om elke UI-wijziging te valideren en wees voorbereid op iteratieve feedback.
-   **Sidebar logica:** De actieve module wordt nu bijgehouden in  via de  sleutel. Dit zorgt ervoor dat de juiste sidebar zichtbaar blijft, zelfs op algemene pagina's zoals .

**documents and test reports created in this job**
-   /app/test_reports/iteration_52.json
-   /app/memory/PRD.md (meerdere keren bijgewerkt)

**Last 10 User Messages and any pending HUMAN messages**
1.  **User:** De factuurstatus is Concept en ik kan er niets mee doen. (COMPLETED - Actiemenu toegevoegd).
2.  **User:** Ik zie geen optie om een betaling aan de factuur toe te voegen. (COMPLETED - Betalingsfunctie toegevoegd).
3.  **User:** Bij Voorraad werkt het aantal niet en Nieuwe Voorraadmutatie geeft een fout. (COMPLETED).
4.  **User:** Ik zie geen bewerk/verwijder acties bij Producten. (COMPLETED).
5.  **User:** Ik zie ook geen acties bij Mutaties. (COMPLETED).
6.  **User:** De Factuur Aanmaken knop werkt niet. (COMPLETED).
7.  **User:** Ik wil een zoekbalk onder het logo in de sidebar. (COMPLETED).
8.  **User:** Ik wil de sidebar kunnen inklappen, zoals op de screenshot. (COMPLETED).
9.  **User:** Als de sidebar is ingeklapt, wil ik de naam zien als ik over een icoon hover. (COMPLETED).
10. **User:** De sidebar-headers moeten weg, de Dashboard-link moet de modulenaam zijn. (COMPLETED).

**Project Health Check:**
-   **Broken:** Geen. Alle recent gemelde problemen zijn opgelost. De onderliggende technische schuld (veldnaam-inconsistentie, groot  bestand) vormt echter een risico voor toekomstige stabiliteit.
-   **Mocked:** Geen.

**3rd Party Integrations**
-   **playwright:** (v1.44.0) Voor web scraping.
-   **APScheduler:** (v3.11.2) Voor achtergrondtaken.
-   **recharts:** (v3.7.0) Voor grafieken.
-   **mt940:** (v0.7.0) Voor bankbestanden.
-   **reportlab:** (v4.4.9) Voor PDF's.
-   **openpyxl:** (v3.1.5) Voor Excel.
-   **aiosmtplib:** (v5.1.0) Voor e-mail.

**Testing status**
-   **Testing agent used after significant changes:** YES
-   **Troubleshoot agent used after agent stuck in loop:** NO
-   **Test files created:** []
-   **Known regressions:** Geen.

**Credentials to test flow:**
-   **Gebruikersnaam:** 
-   **Wachtwoord:** 

**What agent forgot to execute**
-   De agent heeft geen structurele refactoring uitgevoerd om de terugkerende veldnaam-inconsistenties op te lossen. Er zijn alleen lokale patches toegepast.
-   De agent heeft de voorgestelde refactoring van het kritiek grote -bestand niet uitgevoerd.</analysis>
